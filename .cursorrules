# 项目级 AI 行为准则

## 1. 架构规范 (Monorepo)
- **结构**: 采用 Monorepo，分为 `packages/protocol` (Shared), `packages/server`, `packages/client` 等。
- **解耦**: 核心业务逻辑必须提取为纯函数放入 `packages/protocol`，严禁与 UI 或 I/O 逻辑耦合。
- **接口先行**: 跨模块开发时，必须先在 `packages/protocol` 定义 Shared Types。

## 2. 开发流程 (TDD & Parallel)
- **TDD 强制**: 在编写实现代码前，必须先编写失败的单元测试 (`*.test.ts`)。
- **独立性**: 每个 package 必须能独立运行 `npm test`。
- **Mocking**: 单元测试中必须 Mock 掉系统调用 (Socket, Child Process, FS)。
- **Testing**: 推荐使用 Vitest。

## 3. 技术栈规范
- **框架**: 必须使用 React 18+ 和 Next.js 14 (App Router) 或 Vite + React。
- **后端**: Node.js + Express/Socket.io。
- **样式**: 仅使用 TailwindCSS，禁止使用 CSS Modules 或 styled-components。
- **语言**: 必须使用 TypeScript，且不使用 `any` 类型。

## 4. 代码风格
- 组件命名使用 PascalCase。
- 每个文件仅导出一个主要组件。
- 使用 `const` 定义函数，而不是 `function` 关键字。

## 5. 分支管理与开发流程 (Git Workflow)
- **分支策略**:
  - `main`: 仅用于发布稳定版本。
  - `dev`: 主要开发分支，包含最新特性。
  - `feat/*` 或 `fix/*`: 功能/修复分支，用于具体任务开发。
- **开发规则**:
  - **禁止直接在 `dev` 或 `main` 分支上提交代码**。
  - 所有新功能/修复必须在基于 `dev` 创建的独立分支（如 `feat/user-login`）上进行。
  - 功能开发完成并验证通过后，方可合并回 `dev`。
  - `dev` 分支稳定后，定期合并至 `main`。
- **Push 规则**:
  - **禁止自动 Push**: 禁止随意执行 `git push`。
  - **Commit 优先**: 开发过程中应频繁进行本地 `git commit`。
  - **Push 审批**: 仅在功能开发完全结束、测试通过，并**获得用户明确同意后**，才允许执行 `push` 操作。

## 6. 文档规范
- **功能说明**: 每完成一个功能模块，必须在该模块目录下输出一份详细说明文档（如 `README.md` 或 `API.md`）。
- **文档内容**: 必须包含 1. 接口接受参数 (Inputs) 2. 输出参数 (Outputs) 3. 使用示例 (Usage Examples) 4. 内部逻辑简述 (Internal Logic)。

## 7. 特殊要求
- 在修改 `src/core/` 目录下的文件前，必须先运行 `npm run test:core` 确保环境正常。
- 所有的 API 请求必须通过 `src/lib/api-client.ts` 发起，禁止直接使用 `fetch`。
